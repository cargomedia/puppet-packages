node default {

  host { 'example.com':
    ip => '127.0.0.1',
  }

  class { 'jetbrains::upsource':
    port     => 8083,
    host     => 'example.com',
    ssl_cert => '-----BEGIN CERTIFICATE-----
MIIDJjCCAg6gAwIBAgIJALz0SCS44yRnMA0GCSqGSIb3DQEBBQUAMBYxFDASBgNV
BAMTC2V4YW1wbGUuY29tMB4XDTEzMTAzMDEzMDcxNVoXDTIzMTAyODEzMDcxNVow
FjEUMBIGA1UEAxMLZXhhbXBsZS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAw
ggEKAoIBAQDQFxu6CmCyMe/VxOH+pdWJjBPFlZYmQlchzbmTfeB99024TaM5yJwI
A8Vj7hfToNAD5fpy++HbLxLhT29Kp6vaX7tSiwMS3A8EpWmxAG2xDNQNNcvoLfSG
0ISxfEkd/0300wTD2Q7n75BBC/8t42F4m2AnBIBQoImlW92YPZFTNd479pQkrVrT
L05Ji9GXErJIBiv3+ItiRTFjKM7oa6qTjrQrn53UnqMf8iQW7OpBJKvPiALNKjMk
8mnsbHNCGKdmKBYH5BfCBtE3s/eU3qmRlMzKyaZGuuYrcYQ2i9p4trlVYwNWR0Lq
MVSUIaihpIxh/Tm1LG5Bf2fPQN2V2yuTAgMBAAGjdzB1MB0GA1UdDgQWBBSvPF8p
H+PdQEwJS705QmOyWLLcfDBGBgNVHSMEPzA9gBSvPF8pH+PdQEwJS705QmOyWLLc
fKEapBgwFjEUMBIGA1UEAxMLZXhhbXBsZS5jb22CCQC89EgkuOMkZzAMBgNVHRME
BTADAQH/MA0GCSqGSIb3DQEBBQUAA4IBAQAt3vMOIItZf12CwPcXBOZ3RUEJIou9
7wuNTKIF3+HMTUyWg+VZfRxm1S/9OYJMaBthyyW9LJFMl3Htqh5HXv1U+W5hV+Xk
Ngh+1+Yq8Gs78s0979nVN9x8i0KcWrrR8vRsGs7x4ThUxjKIxBsUYFX1RPENht3X
rnHsY5VbBtUW+MKK/P+fKTc3XVOna4S8H/5XT5UO3Aegt9Ml+rIagp6ctQL4UGlV
abjF+8PLHVPo8Dzkeo9LS1FHnTu2QPr3vUC1qec14/shDQY9CVc/Kcx4cnTReaMI
GKZzkhQsDIR77OgSy/dkzhPI9EbGu1mketb7Ro8V+vo1XEH5aG3TJtcp
-----END CERTIFICATE-----
',
    ssl_key  => '-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEA0BcbugpgsjHv1cTh/qXViYwTxZWWJkJXIc25k33gffdNuE2j
OcicCAPFY+4X06DQA+X6cvvh2y8S4U9vSqer2l+7UosDEtwPBKVpsQBtsQzUDTXL
6C30htCEsXxJHf9N9NMEw9kO5++QQQv/LeNheJtgJwSAUKCJpVvdmD2RUzXeO/aU
JK1a0y9OSYvRlxKySAYr9/iLYkUxYyjO6Guqk460K5+d1J6jH/IkFuzqQSSrz4gC
zSozJPJp7GxzQhinZigWB+QXwgbRN7P3lN6pkZTMysmmRrrmK3GENovaeLa5VWMD
VkdC6jFUlCGooaSMYf05tSxuQX9nz0DdldsrkwIDAQABAoIBACgmXUYvHGslcXYY
j9ZXXvU0Hth/vUHSiQdPr1/C6N7FKazG5hiPGXP+bkaSuOwvWhN2ezVWXkSxN35b
mkiYQ3NWB0ms4sHvzcICvHrXb1K6++s0lwxMWaLtdrzcEyuDiCIV2RSEu/iKY5X5
X5oWBkeECzBcEPn9j7FlIUNvlautHrprmV43nWVoWDf0r8smxMNvFo72KUJs7IEB
aMJCGxCc1ukK/LQQSYzxS4pi+dZNIYCaD8BLA7hOE68QpE2PegLY2RbGX6Z5D8vR
xJuGnBcD/XlnsTlA8k2Se1k0SwAhS3ObXaYvw+xhmdgoQVxRtg5SuZ/zGTNyp64X
J469VskCgYEA+yv6RRL7oQTWRpMI6PEjcycna2aZ0pqnZYR3JrukAo92ZmzSefpH
s5l9MW8Fc+DwhXKw0vMXlqrG4ac7moRn3LatmysAE/WLGv8zzjUYcokBrYMP9lHJ
dXF2Xf7qYrRCMaEX4+d1jldXu9u8AWlcvS9RSNQYiVaz8YwgKOiwOm0CgYEA1Bcg
IHfuwKYBIhtF/wW5Jzwp4dRjHEsGJC5CWpT8BiQ0qBTixFr/bHQTzUT/AMQdPH77
lKADq4h8y+09P92fJYoHGqUv2DbL4I5El3tIdbhXbfcQtWIz6gZkACR8b3Al/MOF
gS+BERIe5CNuY3z4ir+VFdAeLPqWwuACxTLZPf8CgYAx/8EkOvEoToQxLFfbtxTt
eV/Ze2UnjW3BQatOZI/ziodxQDxt16qqT+WiD42wUZjPl9MnSwjpDznj9Zxh1/Ws
9Bh/CQJM9tYoG6E+bUdelXNmDO8Cg6ls3ZdIgtQ5rdR3eK/+yDaYjT6DwOweA9FY
P7EYpE/2FvJfJRvJyPg7yQKBgGITd5XMICoSGgANoKa3nNFZ7vwxXMuene5pPeHp
d0nXwEnhrqOieO9MFkQcHdfa2LI6/lfSTyApc5xRzrsT3x5a38IglSlk3Y6v+2QZ
bH6Tikqdr6pRCTS1U9UFCk32DHsAZ2I/921Pdd2FzOxQxBZVVbnKjcm677CaKm3K
f889AoGBAPGxO3FcpUR7nghtwZfB4swKWej5oBsBYbhJfbf35mVmrqNiGqeYd6eW
eX+RzJyQxtZbvtQiHGFqYuHLmtPWteyadxj+y6w6hpbcQzbWkskAtFwSHILI0hx3
0GMie3CQ2ud3klexfzuRdKuWxq/14bjfjY5pbmnOdDEZbQH0zo9z
-----END RSA PRIVATE KEY-----
',
  }
  ->

  exec { 'wait for UNKNOWN state to disappear':
    command  => 'while ! (netstat -ntlap | grep :8083 | grep LISTEN); do sleep 0.5; done',
    provider => shell,
    timeout  => 30,
  }
}